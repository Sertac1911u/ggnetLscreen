<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TFF API Test - Tüm Veriler</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .endpoint-card {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            border: 1px solid #4b5563;
            transition: all 0.3s ease;
        }
        .endpoint-card:hover {
            border-color: #10b981;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
        }
        .json-viewer {
            background: #111827;
            border: 1px solid #374151;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
        }
        .status-success { color: #10b981; }
        .status-error { color: #ef4444; }
        .status-loading { color: #f59e0b; }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold text-center mb-8 text-green-400">TFF API Test Sayfası</h1>
        <p class="text-center text-gray-300 mb-8">API'den alınan tüm verileri test edebilir ve görüntüleyebilirsiniz</p>

        <!-- API Status -->
        <div class="mb-8 p-4 rounded-lg bg-gray-800 border border-gray-700">
            <h2 class="text-xl font-semibold mb-2">API Durumu</h2>
            <div id="api-status" class="flex items-center">
                <span class="mr-2">Kontrol ediliyor...</span>
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-green-400"></div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="mb-8 p-4 rounded-lg bg-gray-800 border border-gray-700">
            <h2 class="text-xl font-semibold mb-4">Kontrol Paneli</h2>
            <div class="flex flex-wrap gap-2">
                <button onclick="testAllEndpoints()" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-medium transition-colors">
                    Tüm Endpointleri Test Et
                </button>
                <button onclick="clearResults()" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-medium transition-colors">
                    Sonuçları Temizle
                </button>
                <button onclick="exportResults()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium transition-colors">
                    JSON Olarak İndir
                </button>
            </div>
        </div>

        <!-- API Endpoints -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Super League -->
            <div class="endpoint-card p-6 rounded-lg">
                <h3 class="text-xl font-semibold mb-4 text-green-400">Süper Lig</h3>
                <button onclick="testEndpoint('/live', 'super-league')" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg mb-4 transition-colors">
                    Test Et
                </button>
                <div id="super-league-status" class="mb-2"></div>
                <div id="super-league-result" class="json-viewer p-3 hidden"></div>
            </div>

            <!-- TFF 1. Lig -->
            <div class="endpoint-card p-6 rounded-lg">
                <h3 class="text-xl font-semibold mb-4 text-green-400">TFF 1. Lig</h3>
                <button onclick="testEndpoint('/live/league/tff-1', 'tff1')" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg mb-4 transition-colors">
                    Test Et
                </button>
                <div id="tff1-status" class="mb-2"></div>
                <div id="tff1-result" class="json-viewer p-3 hidden"></div>
            </div>

            <!-- TFF 2. Lig Kırmızı -->
            <div class="endpoint-card p-6 rounded-lg">
                <h3 class="text-xl font-semibold mb-4 text-green-400">TFF 2. Lig Kırmızı</h3>
                <button onclick="testEndpoint('/live/league/tff-2/group/1', 'tff2-red')" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg mb-4 transition-colors">
                    Test Et
                </button>
                <div id="tff2-red-status" class="mb-2"></div>
                <div id="tff2-red-result" class="json-viewer p-3 hidden"></div>
            </div>

            <!-- TFF 2. Lig Beyaz -->
            <div class="endpoint-card p-6 rounded-lg">
                <h3 class="text-xl font-semibold mb-4 text-green-400">TFF 2. Lig Beyaz</h3>
                <button onclick="testEndpoint('/live/league/tff-2/group/2', 'tff2-white')" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg mb-4 transition-colors">
                    Test Et
                </button>
                <div id="tff2-white-status" class="mb-2"></div>
                <div id="tff2-white-result" class="json-viewer p-3 hidden"></div>
            </div>

            <!-- TFF 3. Lig Grupları -->
            <div class="endpoint-card p-6 rounded-lg">
                <h3 class="text-xl font-semibold mb-4 text-green-400">TFF 3. Lig Tüm Gruplar</h3>
                <button onclick="testEndpoint('/live/league/tff-3/all', 'tff3-all')" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg mb-4 transition-colors">
                    Test Et
                </button>
                <div id="tff3-all-status" class="mb-2"></div>
                <div id="tff3-all-result" class="json-viewer p-3 hidden"></div>
            </div>

            <!-- Amatör Lig -->
            <div class="endpoint-card p-6 rounded-lg">
                <h3 class="text-xl font-semibold mb-4 text-green-400">Amatör Lig Tüm Gruplar</h3>
                <button onclick="testEndpoint('/live/league/amateur/all', 'amateur-all')" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg mb-4 transition-colors">
                    Test Et
                </button>
                <div id="amateur-all-status" class="mb-2"></div>
                <div id="amateur-all-result" class="json-viewer p-3 hidden"></div>
            </div>

            <!-- Kocaelispor Fikstürü -->
            <div class="endpoint-card p-6 rounded-lg">
                <h3 class="text-xl font-semibold mb-4 text-green-400">Kocaelispor Fikstürü</h3>
                <button onclick="testEndpoint('/kocaelispor/fixtures?fill=1', 'kocaeli-fixtures')" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg mb-4 transition-colors">
                    Test Et
                </button>
                <div id="kocaeli-fixtures-status" class="mb-2"></div>
                <div id="kocaeli-fixtures-result" class="json-viewer p-3 hidden"></div>
            </div>

            <!-- Kocaelispor Son Kadro -->
            <div class="endpoint-card p-6 rounded-lg">
                <h3 class="text-xl font-semibold mb-4 text-green-400">Kocaelispor Son Kadro</h3>
                <button onclick="testEndpoint('/kocaelispor/lineup/latest', 'kocaeli-lineup')" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg mb-4 transition-colors">
                    Test Et
                </button>
                <div id="kocaeli-lineup-status" class="mb-2"></div>
                <div id="kocaeli-lineup-result" class="json-viewer p-3 hidden"></div>
            </div>

            <!-- Health Check -->
            <div class="endpoint-card p-6 rounded-lg">
                <h3 class="text-xl font-semibold mb-4 text-green-400">Health Check</h3>
                <button onclick="testEndpoint('/health', 'health')" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg mb-4 transition-colors">
                    Test Et
                </button>
                <div id="health-status" class="mb-2"></div>
                <div id="health-result" class="json-viewer p-3 hidden"></div>
            </div>

            <!-- Custom Endpoint Test -->
            <div class="endpoint-card p-6 rounded-lg">
                <h3 class="text-xl font-semibold mb-4 text-green-400">Özel Endpoint Testi</h3>
                <input type="text" id="custom-endpoint" placeholder="/live/league/tff-3/group/1" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg mb-4 text-white">
                <button onclick="testCustomEndpoint()" class="w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg mb-4 transition-colors">
                    Test Et
                </button>
                <div id="custom-status" class="mb-2"></div>
                <div id="custom-result" class="json-viewer p-3 hidden"></div>
            </div>
        </div>

        <!-- Summary Section -->
        <div class="mt-8 p-4 rounded-lg bg-gray-800 border border-gray-700">
            <h2 class="text-xl font-semibold mb-4">Test Özeti</h2>
            <div id="test-summary" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-center">
                    <div id="total-tests" class="text-2xl font-bold text-blue-400">0</div>
                    <div class="text-gray-400">Toplam Test</div>
                </div>
                <div class="text-center">
                    <div id="successful-tests" class="text-2xl font-bold text-green-400">0</div>
                    <div class="text-gray-400">Başarılı</div>
                </div>
                <div class="text-center">
                    <div id="failed-tests" class="text-2xl font-bold text-red-400">0</div>
                    <div class="text-gray-400">Başarısız</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://127.0.0.1:8000';
        let testResults = {};
        let testStats = { total: 0, success: 0, failed: 0 };

        // Check API status on load
        window.addEventListener('load', checkApiStatus);

        async function checkApiStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                document.getElementById('api-status').innerHTML =
                    '<span class="status-success">✓ API Çalışıyor</span>';
            } catch (error) {
                document.getElementById('api-status').innerHTML =
                    '<span class="status-error">✗ API Bağlantısı Başarısız</span>';
            }
        }

        async function testEndpoint(endpoint, elementId) {
            const statusEl = document.getElementById(`${elementId}-status`);
            const resultEl = document.getElementById(`${elementId}-result`);

            // Reset
            statusEl.innerHTML = '<span class="status-loading">⏳ Test ediliyor...</span>';
            resultEl.classList.add('hidden');

            try {
                const startTime = Date.now();
                const response = await fetch(`${API_BASE_URL}${endpoint}`);
                const responseTime = Date.now() - startTime;

                if (response.ok) {
                    const data = await response.json();

                    // Success
                    statusEl.innerHTML = `<span class="status-success">✓ Başarılı (${responseTime}ms)</span>`;
                    resultEl.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                    resultEl.classList.remove('hidden');

                    // Store result
                    testResults[endpoint] = { success: true, data, responseTime };
                    testStats.success++;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                // Error
                statusEl.innerHTML = `<span class="status-error">✗ Hata: ${error.message}</span>`;
                testResults[endpoint] = { success: false, error: error.message };
                testStats.failed++;
            }

            testStats.total++;
            updateTestSummary();
        }

        async function testCustomEndpoint() {
            const endpoint = document.getElementById('custom-endpoint').value.trim();
            if (!endpoint) {
                alert('Lütfen bir endpoint girin!');
                return;
            }

            if (!endpoint.startsWith('/')) {
                document.getElementById('custom-endpoint').value = '/' + endpoint;
            }

            await testEndpoint(endpoint, 'custom');
        }

        async function testAllEndpoints() {
            // Clear previous results
            clearResults();

            const endpoints = [
                { url: '/health', id: 'health' },
                { url: '/live', id: 'super-league' },
                { url: '/live/league/tff-1', id: 'tff1' },
                { url: '/live/league/tff-2/group/1', id: 'tff2-red' },
                { url: '/live/league/tff-2/group/2', id: 'tff2-white' },
                { url: '/live/league/tff-3/all', id: 'tff3-all' },
                { url: '/live/league/amateur/all', id: 'amateur-all' },
                { url: '/kocaelispor/fixtures?fill=1', id: 'kocaeli-fixtures' },
                { url: '/kocaelispor/lineup/latest', id: 'kocaeli-lineup' }
            ];

            for (const endpoint of endpoints) {
                await testEndpoint(endpoint.url, endpoint.id);
                // Small delay between requests
                await new Promise(resolve => setTimeout(resolve, 100));
            }
        }

        function clearResults() {
            testResults = {};
            testStats = { total: 0, success: 0, failed: 0 };

            // Clear all status and result elements
            const statusElements = document.querySelectorAll('[id$="-status"]');
            const resultElements = document.querySelectorAll('[id$="-result"]');

            statusElements.forEach(el => el.innerHTML = '');
            resultElements.forEach(el => {
                el.innerHTML = '';
                el.classList.add('hidden');
            });

            updateTestSummary();
        }

        function updateTestSummary() {
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('successful-tests').textContent = testStats.success;
            document.getElementById('failed-tests').textContent = testStats.failed;
        }

        function exportResults() {
            if (Object.keys(testResults).length === 0) {
                alert('Henüz test sonucu yok!');
                return;
            }

            const exportData = {
                timestamp: new Date().toISOString(),
                apiBaseUrl: API_BASE_URL,
                summary: testStats,
                results: testResults
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], {
                type: 'application/json'
            });

            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tff-api-test-results-${new Date().toISOString().slice(0, 19)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Sample match detail test function
        async function testMatchDetail() {
            // First get fixtures to find a match ID
            try {
                const fixturesResponse = await fetch(`${API_BASE_URL}/kocaelispor/fixtures?fill=1`);
                const fixturesData = await fixturesResponse.json();

                if (fixturesData.fixtures && fixturesData.fixtures.length > 0) {
                    const matchWithId = fixturesData.fixtures.find(f => f.macId);
                    if (matchWithId) {
                        await testEndpoint(`/match/detail/${matchWithId.macId}`, 'custom');
                        document.getElementById('custom-endpoint').value = `/match/detail/${matchWithId.macId}`;
                    }
                }
            } catch (error) {
                console.error('Match detail test failed:', error);
            }
        }
    </script>
</body>
</html>